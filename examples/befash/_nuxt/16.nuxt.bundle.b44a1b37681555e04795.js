webpackJsonp([16],{614:function(e,t,i){function a(e){i(887)}var r=i(75)(i(726),i(848),a,null,null);e.exports=r.exports},662:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:{value:String},data:function(){return{progress:0}},methods:{handleUplaadSuccess:function(e,t){this.progress=0,console.log(e),this.$emit("input",e.data)},empty:function(){this.$emit("input","")},on_upload:function(e){this.progress=parseInt(e.percent)}}}},663:function(e,t,i){t=e.exports=i(76)(!0),t.push([e.i,".editor-upload .el-upload-dragger{width:100px;height:100px}.empty-upload{float:left;margin-top:68px;margin-left:16px;font-size:12px;color:#20a0ff;text-decoration:underline;cursor:pointer}","",{version:3,sources:["/var/gdpublic/gdpublic/components/editor-upload.vue"],names:[],mappings:"AACA,kCACI,YAAa,AACb,YAAc,CACjB,AACD,cACI,WAAY,AACZ,gBAAiB,AACjB,iBAAkB,AAClB,eAAgB,AAChB,cAAe,AACf,0BAA2B,AAC3B,cAAgB,CACnB",file:"editor-upload.vue",sourcesContent:["\n.editor-upload .el-upload-dragger {\n    width: 100px;\n    height: 100px;\n}\n.empty-upload {\n    float: left;\n    margin-top: 68px;\n    margin-left: 16px;\n    font-size: 12px;\n    color: #20a0ff;\n    text-decoration: underline;\n    cursor: pointer;\n}\n"],sourceRoot:""}])},665:function(e,t,i){function a(e){i(667)}var r=i(75)(i(662),i(666),a,null,null);e.exports=r.exports},666:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"editor-upload"},[i("el-upload",{staticStyle:{float:"left"},attrs:{drag:"",action:"/upload/image","show-file-list":!1,"on-success":e.handleUplaadSuccess,"on-progress":e.on_upload}},[e.progress?i("div",{staticStyle:{height:"100px",background:"#fff"}},[i("el-progress",{staticStyle:{padding:"20px 0"},attrs:{"text-inside":!0,"stroke-width":18,percentage:e.progress}})],1):e._e(),e.value?i("img",{attrs:{src:e.getImagePath(e.value)}}):e._e(),i("i",{staticClass:"el-icon-upload"})]),i("div",{staticClass:"empty-upload",on:{click:function(t){e.empty()}}},[e._v("清空")])],1)},staticRenderFns:[]}},667:function(e,t,i){var a=i(663);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i(77)("ce85faaa",a,!0)},669:function(e,t,i){"use strict";var a=i(11),r=i.n(a),n=i(103),o=i.n(n),s=i(102),l=i.n(s),p=i(162),c=i.n(p),d=i(163),u=i.n(d),f=function(){function e(t){c()(this,e),this.view=t,this.load=new THREE.TextureLoader,this.init(),window.addEventListener("resize",function(){this.renderer.setSize(this.view.offsetWidth,this.view.offsetHeight),this.camera.aspect=this.view.offsetWidth/this.view.offsetHeight,this.camera.updateProjectionMatrix(),this.render()}.bind(this))}return u()(e,[{key:"init",value:function(){this.initScene(),this.initCamera(),this.initRender(),this.initLight(),this.initMesh(),this.initControls(),this.view.appendChild(this.renderer.domElement),this.render()}},{key:"initScene",value:function(){this.scene=new THREE.Scene}},{key:"initCamera",value:function(){this.camera=new THREE.PerspectiveCamera(60,this.view.offsetWidth/this.view.offsetHeight,.01,20),this.camera.position.z=1.5,this.camera.position.y=0,this.camera.lookAt({x:0,y:0,z:0}),this.camera.up.x=this.camera.up.z=0,this.camera.up.y=1}},{key:"initRender",value:function(){this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(16777215),this.renderer.setSize(this.view.offsetWidth,this.view.offsetHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.shadowMapSoft=!0,this.renderer.setPixelRatio(window.devicePixelRatio)}},{key:"initControls",value:function(){this.controls=new THREE.OrbitControls(this.camera,this.view,this.mesh),this.controls.minDistance=.3,this.controls.maxDistance=5,this.controls.addEventListener("change",this.render.bind(this))}},{key:"initLight",value:function(){var e=new THREE.AmbientLight(16777215,.5);this.scene.add(e);var t=new THREE.SpotLight(16777215,.5,100,1,.2,1.5);t.position.set(0,0,5),this.scene.add(t)}},{key:"initMesh",value:function(){var e=new THREE.DodecahedronBufferGeometry(.5,4);this.mesh=new THREE.Mesh(e,new THREE.MeshPhongMaterial),this.scene.add(this.mesh)}},{key:"setMaterial",value:function(){function e(e){return t.apply(this,arguments)}var t=l()(o.a.mark(function e(t){var i,a,r,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i={},e.t0=o.a.keys(t);case 2:if((e.t1=e.t0()).done){e.next=24;break}if(a=e.t1.value,!t.hasOwnProperty(a)||!t[a]||"#000"===t[a]){e.next=22;break}if(!a.includes("map")&&!a.includes("Map")){e.next=21;break}if(!a.includes("aoMapIntensity")){e.next=10;break}i[a]=t[a],e.next=19;break;case 10:return e.next=12,this.loadMaterial(t[a]);case 12:if(i[a]=e.sent,!a.includes("env")){e.next=19;break}for(r=[],n=0;n<6;n++)r[n]=t[a];return e.next=18,this.loadPicture(r);case 18:i[a]=e.sent;case 19:e.next=22;break;case 21:i[a]=t[a];case 22:e.next=2;break;case 24:this.mesh.material=new THREE.MeshPhysicalMaterial(i),this.render();case 26:case"end":return e.stop()}},e,this)}));return e}()},{key:"loadPicture",value:function(e){var t=this;return this.loader=(new THREE.CubeTextureLoader).setPath("/upload/"),new r.a(function(i,a){t.loader.load(e,function(e){i(e)})})}},{key:"loadMaterial",value:function(e){var t=this;return new r.a(function(i,a){t.load.load("/upload/"+e,function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(1,1),i(e)})})}},{key:"updateMaterialColor",value:function(e,t){this.mesh.material[e]=new THREE.Color(t),this.render()}},{key:"updateMaterialMap",value:function(){function e(e,i){return t.apply(this,arguments)}var t=l()(o.a.mark(function e(t,i){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=7;break}return e.next=3,this.loadMaterial(i);case 3:this.mesh.material[t]=e.sent,this.mesh.material.needsUpdate=!0,e.next=9;break;case 7:this.mesh.material[t]=null,this.mesh.material.needsUpdate=!0;case 9:this.render();case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"updateMaterialNumber",value:function(e,t){this.mesh.material[e]=t,this.render()}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}}]),e}();t.a=f},726:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(67),r=i.n(a),n=i(665),o=i.n(n),s=i(669);t.default={middleware:"check-auth",head:function(){return{title:"材质编辑器",meta:[{hid:"keyword",name:"keyword",content:"材质编辑器,百丰网络科技有限公司,3d"},{hid:"description",name:"description",content:"材质编辑器,百丰网络科技有限公司"}]}},fetch:function(e){var t=this,i=e.route;return e.store.dispatch("fabric/one",i.params.id).then(function(e){t.form=e})},mounted:function(){this.$preview=new s.a(document.getElementById("fabric-previe")),this.$preview.setMaterial(this.form)},components:{EditorUpload:o.a},data:function(){return{form:this.$store.state.fabric.material}},watch:{"form.color":function(e){this.$preview.updateMaterialColor("color",e)},"form.transparent":function(e){this.$preview.updateMaterialNumber("transparent",e)},"form.opacity":function(e){this.$preview.updateMaterialNumber("opacity",e)},"form.reflectivity":function(e){this.$preview.updateMaterialNumber("reflectivity",e)},"form.refractionRatio":function(e){this.$preview.updateMaterialNumber("refractionRatio",e)},"form.aoMapIntensity":function(e){this.$preview.updateMaterialNumber("aoMapIntensity",e)},"form.metalness":function(e){this.$preview.updateMaterialNumber("metalness",e)},"form.roughness":function(e){this.$preview.updateMaterialNumber("roughness",e)},"form.clearCoat":function(e){this.$preview.updateMaterialNumber("clearCoat",e)},"form.clearCoatRoughness":function(e){this.$preview.updateMaterialNumber("clearCoatRoughness",e)},"form.emissive":function(e){this.$preview.updateMaterialColor("emissive",e)},"form.specular":function(e){this.$preview.updateMaterialColor("specular",e)},"form.shading":function(e){this.$preview.updateMaterialNumber("shading",e)},"form.wireframe":function(e){this.$preview.updateMaterialNumber("wireframe",e)},"form.map":function(e){this.$preview.updateMaterialMap("map",e)},"form.aomap":function(e){this.$preview.updateMaterialMap("aoMap",e)},"form.lightMap":function(e){this.$preview.updateMaterialMap("lightMap",e)},"form.specularMap":function(e){this.$preview.updateMaterialMap("specularMap",e)},"form.alphaMap":function(e){this.$preview.updateMaterialMap("alphaMap",e)},"form.normalMap":function(e){this.$preview.updateMaterialMap("normalMap",e)},"form.displacementMap":function(e){this.$preview.updateMaterialMap("displacementMap",e)}},methods:{saveConfig:function(){var e=this,t={};for(var i in this.form)t[i]=this.form[i];this.$store.dispatch("fabric/saveMaterial",{id:this.$route.params.id,config:r()(t)}).then(function(){e.$message.success("保存成功")})}}}},767:function(e,t,i){t=e.exports=i(76)(!0),t.push([e.i,"#setting{position:absolute;top:0;background:#eee;width:300px;overflow-y:auto;padding-bottom:50px;border-left:1px solid #ccc}#save,#setting{right:0;bottom:0}#save{overflow:hidden;width:268px;background:#f5f5f5;border-top:1px solid #ccc;position:fixed;height:50px;z-index:2000;padding:0 16px;margin-top:8px;line-height:22px}#save-btn{width:100%;margin-top:8px;line-height:34px;border-radius:4px;background:#f53;text-align:center;cursor:pointer;color:#fff;-webkit-transition:background .3s;-o-transition:background .3s;transition:background .3s}#save-btn:hover{background:#f75}#fabric-previe{position:absolute;top:0;left:0;right:300px;bottom:0}.setting-title{color:#505050;text-align:center;font-weight:400;margin:0 -16px;padding:15px 0;border-bottom:1px solid rgba(0,0,0,.25)}.el-upload-dragger .el-icon-upload{margin:22px 0 16px}.settings-widget{width:300px;padding:8px 16px;border-bottom:1px solid rgba(0,0,0,.25);border-top:1px solid #fff}.settings-widget tr td:first-child{width:80px;color:#888;font-size:12px;font-weight:300}.settings-widget tr{line-height:50px}#setting .el-slider__button-wrapper{top:-24px}","",{version:3,sources:["/var/gdpublic/gdpublic/pages/editor/fabric/_id.vue"],names:[],mappings:"AACA,SACI,kBAAmB,AACnB,MAAO,AAGP,gBAAiB,AACjB,YAAa,AACb,gBAAiB,AACjB,oBAAqB,AACrB,0BAA4B,CAC/B,AACD,eARI,QAAS,AACT,QAAU,CAoBb,AAbD,MACI,gBAAiB,AACjB,YAAa,AACb,mBAAoB,AACpB,0BAA2B,AAC3B,eAAgB,AAChB,YAAa,AAGb,aAAc,AACd,eAAgB,AAChB,eAAgB,AAChB,gBAAkB,CACrB,AACD,UACI,WAAY,AACZ,eAAgB,AAChB,iBAAkB,AAClB,kBAAmB,AACnB,gBAAiB,AACjB,kBAAmB,AACnB,eAAgB,AAChB,WAAY,AACZ,kCAAmC,AACnC,6BAA8B,AAC9B,yBAA2B,CAC9B,AACD,gBACI,eAAiB,CACpB,AACD,eACI,kBAAmB,AACnB,MAAO,AACP,OAAQ,AACR,YAAa,AACb,QAAU,CACb,AACD,eACI,cAAe,AACf,kBAAmB,AACnB,gBAAiB,AACjB,eAAgB,AAChB,eAAgB,AAChB,uCAA4C,CAC/C,AACD,mCACI,kBAAoB,CACvB,AACD,iBACI,YAAa,AACb,iBAAkB,AAClB,wCAA4C,AAC5C,yBAA2B,CAC9B,AACD,mCACI,WAAY,AACZ,WAAY,AACZ,eAAgB,AAChB,eAAiB,CACpB,AACD,oBACI,gBAAkB,CACrB,AACD,oCACI,SAAW,CACd",file:"_id.vue",sourcesContent:["\n#setting {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background: #eee;\n    width: 300px;\n    overflow-y: auto;\n    padding-bottom: 50px;\n    border-left: 1px solid #ccc;\n}\n#save {\n    overflow: hidden;\n    width: 268px;\n    background: #F5F5F5;\n    border-top: 1px solid #ccc;\n    position: fixed;\n    height: 50px;\n    right: 0;\n    bottom: 0;\n    z-index: 2000;\n    padding: 0 16px;\n    margin-top: 8px;\n    line-height: 22px;\n}\n#save-btn {\n    width: 100%;\n    margin-top: 8px;\n    line-height: 34px;\n    border-radius: 4px;\n    background: #f53;\n    text-align: center;\n    cursor: pointer;\n    color: #fff;\n    -webkit-transition: background .3s;\n    -o-transition: background .3s;\n    transition: background .3s;\n}\n#save-btn:hover {\n    background: #f75;\n}\n#fabric-previe {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 300px;\n    bottom: 0;\n}\n.setting-title {\n    color: #505050;\n    text-align: center;\n    font-weight: 400;\n    margin: 0 -16px;\n    padding: 15px 0;\n    border-bottom: 1px solid rgba(0, 0, 0, .25);\n}\n.el-upload-dragger .el-icon-upload {\n    margin: 22px 0 16px;\n}\n.settings-widget {\n    width: 300px;\n    padding: 8px 16px;\n    border-bottom: 1px solid rgba(0, 0, 0, .25);\n    border-top: 1px solid #fff;\n}\n.settings-widget tr td:first-child {\n    width: 80px;\n    color: #888;\n    font-size: 12px;\n    font-weight: 300;\n}\n.settings-widget tr {\n    line-height: 50px;\n}\n#setting .el-slider__button-wrapper {\n    top: -24px;\n}\n"],sourceRoot:""}])},848:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{attrs:{id:"setting"}},[i("h3",{staticClass:"setting-title"},[e._v("材质设置")]),i("div",[i("table",{staticClass:"settings-widget"},[i("tbody",[i("tr",[i("td",[e._v("Color")]),i("td",[i("el-color-picker",{attrs:{"color-format":"hex"},model:{value:e.form.color,callback:function(t){e.form.color=t},expression:"form.color"}})],1)]),i("tr",[i("td",[e._v("Emissive")]),i("td",[i("el-color-picker",{attrs:{"color-format":"hex"},model:{value:e.form.emissive,callback:function(t){e.form.emissive=t},expression:"form.emissive"}})],1)]),i("tr",[i("td",[e._v("Specular")]),i("td",[i("el-color-picker",{attrs:{"color-format":"hex"},model:{value:e.form.specular,callback:function(t){e.form.specular=t},expression:"form.specular"}})],1)])])]),i("table",{staticClass:"settings-widget"},[i("tbody",[i("tr",[i("td",[e._v("Map")]),i("td",[i("editor-upload",{model:{value:e.form.map,callback:function(t){e.form.map=t},expression:"form.map"}})],1)]),i("tr",[i("td",[e._v("AoMap")]),i("td",[i("editor-upload",{model:{value:e.form.aoMap,callback:function(t){e.form.aoMap=t},expression:"form.aoMap"}})],1)]),i("tr",[i("td",[e._v("NormalMap")]),i("td",[i("editor-upload",{model:{value:e.form.normalMap,callback:function(t){e.form.normalMap=t},expression:"form.normalMap"}})],1)]),i("tr",[i("td",[e._v("LightMap")]),i("td",[i("editor-upload",{model:{value:e.form.lightMap,callback:function(t){e.form.lightMap=t},expression:"form.lightMap"}})],1)]),i("tr",[i("td",[e._v("alphaMap")]),i("td",[i("editor-upload",{model:{value:e.form.alphaMap,callback:function(t){e.form.alphaMap=t},expression:"form.alphaMap"}})],1)]),i("tr",[i("td",[e._v("Displacement")]),i("td",[i("editor-upload",{model:{value:e.form.displacementMap,callback:function(t){e.form.displacementMap=t},expression:"form.displacementMap"}})],1)])])]),i("table",{staticClass:"settings-widget"},[i("tbody",[i("tr",[i("td",[e._v("Transparent")]),i("td",[i("el-switch",{model:{value:e.form.transparent,callback:function(t){e.form.transparent=t},expression:"form.transparent"}})],1)]),i("tr",[i("td",[e._v("Opacity")]),i("td",[i("el-slider",{attrs:{min:0,max:1,step:.1},model:{value:e.form.opacity,callback:function(t){e.form.opacity=t},expression:"form.opacity"}})],1)]),i("tr",[i("td",[e._v("refractionRatio")]),i("td",[i("el-slider",{attrs:{min:.01,max:1,step:.01},model:{value:e.form.refractionRatio,callback:function(t){e.form.refractionRatio=t},expression:"form.refractionRatio"}})],1)]),i("tr",[i("td",[e._v("Reflectivity")]),i("td",[i("el-slider",{attrs:{min:.01,max:1,step:.01},model:{value:e.form.reflectivity,callback:function(t){e.form.reflectivity=t},expression:"form.reflectivity"}})],1)]),i("tr",[i("td",[e._v("aoMapIntensity")]),i("td",[i("el-slider",{attrs:{min:.01,max:3,step:.01},model:{value:e.form.aoMapIntensity,callback:function(t){e.form.aoMapIntensity=t},expression:"form.aoMapIntensity"}})],1)]),i("tr",[i("td",[e._v("metalness")]),i("td",[i("el-slider",{attrs:{min:.01,max:1,step:.01},model:{value:e.form.metalness,callback:function(t){e.form.metalness=t},expression:"form.metalness"}})],1)]),i("tr",[i("td",[e._v("roughness")]),i("td",[i("el-slider",{attrs:{min:.01,max:1,step:.01},model:{value:e.form.roughness,callback:function(t){e.form.roughness=t},expression:"form.roughness"}})],1)]),i("tr",[i("td",[e._v("clearCoat")]),i("td",[i("el-slider",{attrs:{min:0,max:1,step:.01},model:{value:e.form.clearCoat,callback:function(t){e.form.clearCoat=t},expression:"form.clearCoat"}})],1)]),i("tr",[i("td",[e._v("clearCoatRoughness")]),i("td",[i("el-slider",{attrs:{min:0,max:1,step:.01},model:{value:e.form.clearCoatRoughness,callback:function(t){e.form.clearCoatRoughness=t},expression:"form.clearCoatRoughness"}})],1)]),i("tr",[i("td",[e._v("Shading")]),i("td",[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.shading,callback:function(t){e.form.shading=t},expression:"form.shading"}},[i("el-option",{attrs:{label:"Smooth",value:2}}),i("el-option",{attrs:{label:"Flat",value:1}})],1)],1)]),i("tr",[i("td",[e._v("Wireframe")]),i("td",[i("el-switch",{model:{value:e.form.wireframe,callback:function(t){e.form.wireframe=t},expression:"form.wireframe"}})],1)])])])])]),i("div",{attrs:{id:"save"}},[i("div",{attrs:{id:"save-btn"},on:{click:e.saveConfig}},[e._v("\n            保存更改\n        ")])]),i("div",{attrs:{id:"fabric-previe"}})])},staticRenderFns:[]}},887:function(e,t,i){var a=i(767);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i(77)("117f9132",a,!0)}});